<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control de Gastos</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #f1f5f9; color: #111; }
    input, select, button { margin: 0.5rem; padding: 0.5rem; }
    .registro { margin: 0.5rem 0; padding: 0.5rem; background: #e2e8f0; border-radius: 6px; }
    .resumen { margin-top: 2rem; padding: 1rem; background: #d1fae5; border: 1px solid #10b981; border-radius: 6px; }
    .alerta { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>💸 Control de Gastos</h1>
  <div>
    <h2>Mes actual: <span id="mes-actual"></span></h2>
    <input type="month" id="mes-selector" onchange="cambiarMes()" />
  </div>
  <div>
    <h2>➕ Ingreso fijo mensual</h2>
    <input type="number" id="ingreso-fijo" placeholder="Ej: 1200" />
    <button onclick="guardarIngresoFijo()">Guardar ingreso fijo</button>
  </div>
  <div>
    <h2>➕ Ingreso extra</h2>
    <input type="number" id="monto-ingreso" placeholder="Monto (€)">
    <input type="date" id="fecha-ingreso">
    <input type="text" id="desc-ingreso" placeholder="Descripción">
    <button onclick="agregarIngresoExtra()">Añadir ingreso extra</button>
    <div id="lista-ingresos"></div>
  </div>
  <div>
    <h2>➖ Añadir gasto</h2>
    <input type="number" id="monto" placeholder="Monto (€)">
    <input type="date" id="fecha-gasto">
    <select id="categoria">
      <option value="Alimentación">Alimentación</option>
      <option value="Transporte">Transporte</option>
      <option value="Suministros">Suministros</option>
      <option value="Ocio">Ocio</option>
      <option value="Otros">Otros</option>
    </select>
    <label><input type="checkbox" id="fijo"> Gasto fijo</label>
    <button onclick="agregarGasto()">Añadir gasto</button>
    <div id="lista-gastos"></div>
  </div>
  <div class="resumen">
    <h2>📊 Resumen</h2>
    <p id="total-ingresos">Ingresos: €0</p>
    <p id="total-gastos">Gastos: €0</p>
    <p id="saldo">Saldo restante: €0</p>
    <p id="alerta-gastos" class="alerta"></p>
    <canvas id="grafico" width="400" height="200"></canvas>
  </div>
  <script>
    let datos = {};
    let mesActual = new Date().toISOString().slice(0,7);
    document.getElementById("mes-selector").value = mesActual;

    function cambiarMes() {
      mesActual = document.getElementById("mes-selector").value;
      actualizarVista();
    }

    function guardarIngresoFijo() {
      if (!datos[mesActual]) datos[mesActual] = { ingresoFijo: 0, ingresos: [], gastos: [] };
      datos[mesActual].ingresoFijo = parseFloat(document.getElementById("ingreso-fijo").value) || 0;
      actualizarVista();
    }

    function agregarIngresoExtra() {
      const monto = parseFloat(document.getElementById("monto-ingreso").value);
      const fecha = document.getElementById("fecha-ingreso").value;
      const desc = document.getElementById("desc-ingreso").value || "Ingreso";
      if (!monto || !fecha) return alert("Completa todos los campos");
      datos[mesActual].ingresos.push({ monto, fecha, desc });
      document.getElementById("monto-ingreso").value = "";
      document.getElementById("fecha-ingreso").value = "";
      document.getElementById("desc-ingreso").value = "";
      actualizarVista();
    }

    function agregarGasto() {
      const monto = parseFloat(document.getElementById("monto").value);
      const fecha = document.getElementById("fecha-gasto").value;
      const categoria = document.getElementById("categoria").value;
      const fijo = document.getElementById("fijo").checked;
      if (!monto || !fecha) return alert("Completa todos los campos");
      datos[mesActual].gastos.push({ monto, fecha, categoria, fijo });
      document.getElementById("monto").value = "";
      document.getElementById("fecha-gasto").value = "";
      document.getElementById("fijo").checked = false;
      actualizarVista();
    }

    function actualizarVista() {
      if (!datos[mesActual]) datos[mesActual] = { ingresoFijo: 0, ingresos: [], gastos: [] };
      document.getElementById("mes-actual").innerText = mesActual;
      let ingresos = datos[mesActual].ingresos.reduce((acc, i) => acc + i.monto, 0);
      let ingresoFijo = datos[mesActual].ingresoFijo || 0;
      let totalIngresos = ingresos + ingresoFijo;
      let totalGastos = datos[mesActual].gastos.reduce((acc, g) => acc + g.monto, 0);
      let saldo = totalIngresos - totalGastos;

      document.getElementById("total-ingresos").innerText = `Ingresos: €${totalIngresos}`;
      document.getElementById("total-gastos").innerText = `Gastos: €${totalGastos}`;
      document.getElementById("saldo").innerText = `Saldo restante: €${saldo}`;
      document.getElementById("alerta-gastos").innerText = saldo < 0 ? "⚠️ Has gastado más de lo que ingresaste" : "";

      let listaGastos = datos[mesActual].gastos.map(g => `<div class='registro'>- €${g.monto} - ${g.categoria} - ${g.fecha} ${g.fijo ? "(fijo)" : ""}</div>`).join("");
      document.getElementById("lista-gastos").innerHTML = listaGastos;

      let listaIngresos = datos[mesActual].ingresos.map(i => `<div class='registro'>+ €${i.monto} - ${i.desc} - ${i.fecha}</div>`).join("");
      document.getElementById("lista-ingresos").innerHTML = listaIngresos;

      const categorias = {};
      datos[mesActual].gastos.forEach(g => {
        categorias[g.categoria] = (categorias[g.categoria] || 0) + g.monto;
      });

      const ctx = document.getElementById("grafico").getContext("2d");
      if (window.miGrafico) window.miGrafico.destroy();
      window.miGrafico = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(categorias),
          datasets: [{
            label: 'Gastos por categoría',
            data: Object.values(categorias),
            backgroundColor: ['#60a5fa', '#f87171', '#facc15', '#34d399', '#a78bfa']
          }]
        }
      });
    }

    actualizarVista();
  </script>
</body>
</html>